
#define F_CPU 20000000
#define column 70

#include <avr/io.h>

unsigned char count;
unsigned int start;
unsigned char temp;
unsigned int time;
unsigned char reset = 250;
unsigned char i;


__flash const unsigned char image []={
	0b00001100,0b00000000,0b00000000,0b00000000,0b00000001,//1
	0b00011100,0b00000000,0b00000000,0b00000000,0b00000001,
	0b00011110,0b00000000,0b00000000,0b00000000,0b00000011,
	0b00011100,0b00000000,0b00000000,0b00000000,0b00000011,
	0b00011100,0b00000000,0b00000000,0b00000000,0b00000011,
	0b00011100,0b00000000,0b00000000,0b00000000,0b00000011,
	0b00011110,0b00000000,0b00000000,0b00000000,0b00000011,
	0b00011111,0b00000000,0b00000000,0b00000000,0b00000111,
	0b00111111,0b11100000,0b00000000,0b00000000,0b00000111,
	0b00111111,0b11110000,0b00000000,0b00000000,0b00000111,//10
	0b00111111,0b11111000,0b00000000,0b00000000,0b00000111,
	0b00111111,0b11111100,0b00000000,0b00000000,0b00000111,
	0b00011111,0b11111110,0b00000000,0b00000000,0b00000111,
	0b00101111,0b11111111,0b00000000,0b00000000,0b00000111,
	0b01011111,0b11111001,0b00000000,0b00000000,0b00000111,
	0b11111011,0b11111011,0b10000000,0b00000000,0b00000111,
	0b11111001,0b11111100,0b01100000,0b00000000,0b00000111,
	0b11110111,0b11110010,0b01111100,0b00000000,0b00000111,
	0b11011111,0b11100011,0b01111110,0b00011111,0b10001111,
	0b11011111,0b11000001,0b01111111,0b11111111,0b11001111,//20
	0b11001011,0b11000000,0b01111111,0b11111000,0b00011111,
	0b01000001,0b10000000,0b00111111,0b11110000,0b10110011,
	0b01111000,0b10000000,0b00111111,0b11110000,0b00000011,
	0b01111100,0b00000000,0b00011111,0b11000000,0b00000011,
	0b01111100,0b00000000,0b00001111,0b10000000,0b00000011,
	0b01110000,0b00000000,0b00001111,0b00000000,0b00000011,
	0b11110000,0b00000000,0b00000000,0b00000000,0b00000011,
	0b11110000,0b00000000,0b00000000,0b00000000,0b00000011,
	0b01101000,0b00000000,0b00000000,0b00000000,0b00000111,
	0b00001000,0b00000011,0b10000000,0b00000000,0b00000111,//30
	0b00000000,0b00000111,0b11000000,0b00000000,0b00000111,
	0b00000011,0b01111111,0b11100000,0b00000000,0b00001111,
	0b00000011,0b11111111,0b11100000,0b00000000,0b00000111,
	0b00000000,0b11011111,0b11000000,0b00000000,0b00000111,
	0b00000101,0b11011111,0b11110000,0b00000000,0b00000111,
	0b01001111,0b11101111,0b11111111,0b11000000,0b00000111,
	0b01011001,0b11101111,0b11111111,0b11110000,0b00000111,
	0b01011111,0b11101111,0b11111111,0b11110000,0b00000111,
	0b00011111,0b11101111,0b11111111,0b11100000,0b00000111,
	0b00011111,0b10111111,0b11111111,0b11000000,0b00000111,//40
	0b00001111,0b11111110,0b11111111,0b00000000,0b00000111,
	0b00001111,0b11111111,0b11110001,0b11000000,0b00001111,
	0b01001111,0b10111111,0b01000011,0b00000000,0b00011111,
	0b00111111,0b11111111,0b00000000,0b00000000,0b00001111,
	0b00011111,0b11111110,0b00000000,0b00000000,0b00001111,
	0b00001111,0b11111100,0b00000000,0b00000000,0b00001111,
	0b00011111,0b11111110,0b00000000,0b00000000,0b00001111,
	0b00011111,0b11111111,0b10000000,0b00000000,0b00000111,
	0b00011111,0b11101111,0b11000000,0b00000000,0b00001111,
	0b00111111,0b11100110,0b00000000,0b00000000,0b00011111,//50
	0b00111111,0b11100110,0b00000000,0b00000000,0b00001111,
	0b01111111,0b11101111,0b00100000,0b00000000,0b00001111,
	0b01111111,0b11111111,0b10110000,0b00000000,0b00001111,
	0b00111111,0b11111111,0b10001000,0b00000000,0b00001111,
	0b00111111,0b11111110,0b00010100,0b00000000,0b00001111,
	0b00111111,0b11111100,0b00110000,0b11110000,0b00011111,
	0b00011111,0b11001001,0b11011001,0b11110000,0b00001111,
	0b00111111,0b11110000,0b01000001,0b11100000,0b00011111,
	0b00011111,0b11011000,0b00011011,0b11100000,0b00001111,
	0b00011111,0b10010000,0b00001001,0b11110000,0b00001111,//60
	0b00111101,0b01100000,0b00001111,0b11111000,0b00000111,
	0b00001110,0b00000000,0b00000100,0b11111100,0b00000111,
	0b00011100,0b00000000,0b00000000,0b01100000,0b00000111,
	0b00011011,0b00000000,0b0000000,0b00000000,0b00000111,
	0b00011110,0b00000000,0b00000000,0b00000000,0b00000011,
	0b00011100,0b00000000,0b00000000,0b00010000,0b00000011,
	0b00011100,0b00000000,0b00000000,0b00110000,0b00000011,
	0b00011000,0b00000000,0b00000000,0b00100000,0b00000001,
	0b00001000,0b00000000,0b00000000,0b00000000,0b00000001,
0b00001000,0b00000000,0b00000000,0b00000000,0b00000001};//70


unsigned char button (void){
	
	unsigned char var;
	PORTD=0b00000100;
	var=PIND;
	var>>=2;
	var&= 0b00000001;
	return var;
}

unsigned int set_time (void){
	
	TCCR1B=0x00;
	TCNT1=0;
	
	while (button()==0) {}
	while (button()==1) {}
	
	TCCR1B=0b00000011;
	
	while (button()==0) {}
	while (button()==1) {}
	TCCR1B=0x00;
	return TCNT1;
}


int main (void){

	DDRB = 0b00000111;
	
	DDRD = 0x00;

	while (1){
		reset++;
		if (reset>250){
			reset=0;
			time=set_time();
			time/=column;
			time*=0.98;
			start=0;
		}
		
		for (i=0; i<column; i++){

			TCCR1B=0x00;
			TCNT1=0;
			TCCR1B=0b00000011;
			
			for (count=0; count<5; count++){
				
				for(i=0; i<8; i++){
					temp=image[count+start];
					temp&=(0b10000000>>i);
					
					if (temp==(0b10000000>>i)) PORTB|=(1<<2);
					else PORTB&=~(1<<2);
					
					PORTB&=0b00000110;
					PORTB|=1;
				}
			}
			
			start+=5;
			if (start==column*5) start=0;

			PORTB|= 0b00000010;
			PORTB&=0x00;
			
			while (TCNT1!=time) {}
			
		}
	}
}